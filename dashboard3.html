<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forêt Wash — Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --bg: #050907;
  --bg2: #080f0b;
  --surface: rgba(10,22,16,0.85);
  --surface-solid: #0a1610;
  --surface2: #0e1f15;
  --surface3: #122b1d;
  --border: rgba(34,80,55,0.35);
  --border-hover: rgba(50,220,120,0.25);
  --text: #eaf5ef;
  --text2: #c4ddd0;
  --text-dim: #4a7a5e;
  --text-muted: #2d5a40;
  --neon: #32e685;
  --neon2: #28d47a;
  --neon-bright: #3fff90;
  --neon-glow: rgba(50,230,133,0.12);
  --neon-glow2: rgba(50,230,133,0.06);
  --teal: #00c9a7;
  --red: #ff4466;
  --red-glow: rgba(255,68,102,0.1);
  --gold: #c8a44e;
  --r: 12px;
}

*{margin:0;padding:0;box-sizing:border-box;}
html{font-size:16px;-webkit-font-smoothing:antialiased;}

body{
  font-family:'Manrope',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* ═══ ATMOSPHERIC BG ═══ */
.bg-scene{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  overflow:hidden;
}
.bg-scene canvas{width:100%;height:100%;}

/* Radial glow blobs */
.glow{
  position:absolute;border-radius:50%;
  filter:blur(140px);
  will-change:transform;
}
.glow-1{
  width:900px;height:500px;
  background:radial-gradient(ellipse,rgba(50,230,133,0.07),transparent 70%);
  top:-15%;left:-10%;
  animation:floatA 45s ease-in-out infinite;
}
.glow-2{
  width:600px;height:600px;
  background:radial-gradient(ellipse,rgba(0,201,167,0.05),transparent 70%);
  bottom:-20%;right:-5%;
  animation:floatB 50s ease-in-out infinite;
}
.glow-3{
  width:400px;height:250px;
  background:radial-gradient(ellipse,rgba(50,230,133,0.04),transparent 70%);
  top:40%;left:50%;transform:translateX(-50%);
  animation:floatC 35s ease-in-out infinite;
}

@keyframes floatA{0%,100%{transform:translate(0,0)scale(1);}33%{transform:translate(50px,-30px)scale(1.08);}66%{transform:translate(-30px,20px)scale(0.95);}}
@keyframes floatB{0%,100%{transform:translate(0,0)scale(1);}50%{transform:translate(-40px,-25px)scale(1.1);}}
@keyframes floatC{0%,100%{transform:translate(-50%,0);}50%{transform:translate(-50%,15px)scale(1.05);}}

/* Grid lines overlay */
.grid-overlay{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:
    linear-gradient(rgba(50,230,133,0.015) 1px, transparent 1px),
    linear-gradient(90deg, rgba(50,230,133,0.015) 1px, transparent 1px);
  background-size:60px 60px;
  mask-image:radial-gradient(ellipse 70% 60% at 50% 30%,black,transparent);
}

/* Grain */
.grain{
  position:fixed;inset:0;z-index:1;pointer-events:none;
  opacity:0.03;
  background:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

.app{position:relative;z-index:2;}

/* ═══ HEADER ═══ */
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 36px;
  border-bottom:1px solid var(--border);
  background:rgba(5,9,7,0.9);
  backdrop-filter:blur(40px);
  position:sticky;top:0;z-index:50;
}

.brand{display:flex;align-items:center;gap:14px;}

.tree-logo{
  width:44px;height:44px;
  filter:drop-shadow(0 0 20px rgba(50,230,133,0.2));
  flex-shrink:0;
}

.brand-text{display:flex;flex-direction:column;}
.brand-name{
  font-family:'Playfair Display',serif;
  font-size:22px;font-weight:700;
  letter-spacing:0.5px;
  color:var(--text);
}
.brand-name em{
  font-style:normal;
  color:var(--neon);
}
.brand-sub{
  font-family:'IBM Plex Mono',monospace;
  font-size:9px;letter-spacing:3.5px;
  text-transform:uppercase;
  color:var(--text-dim);
  margin-top:1px;
}

.header-info{
  display:flex;align-items:center;gap:20px;
  font-family:'IBM Plex Mono',monospace;
  font-size:11px;color:var(--text-dim);
}

.header-date{
  padding:6px 14px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:8px;
}

/* ═══ MAIN ═══ */
.main{padding:28px 36px;max-width:1680px;margin:0 auto;}

/* Period bar */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:28px;
  gap:16px;
  flex-wrap:wrap;
}

.page-title{
  font-family:'Playfair Display',serif;
  font-size:32px;font-weight:700;
  color:var(--text);
}
.page-title span{color:var(--neon);}

.site-tabs{
  display:flex;gap:2px;
  background:rgba(10,22,16,0.8);
  border:1px solid var(--border);
  border-radius:10px;padding:3px;
}

.site-tab{
  padding:9px 22px;border:none;border-radius:8px;
  background:transparent;color:var(--text-dim);
  font-family:'IBM Plex Mono',monospace;
  font-size:12px;font-weight:500;
  cursor:pointer;transition:all 0.2s;
  position:relative;
}
.site-tab:hover:not(.active){color:var(--text2);}
.site-tab.active{
  background:rgba(50,230,133,0.1);
  color:var(--neon);
  box-shadow:0 0 20px rgba(50,230,133,0.06),inset 0 0 20px rgba(50,230,133,0.03);
  border:1px solid rgba(50,230,133,0.2);
}

/* ═══ KPI STRIP ═══ */
.kpi-strip{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
  margin-bottom:28px;
}

.kpi{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:20px;
  backdrop-filter:blur(20px);
  transition:all 0.25s;
  position:relative;
  overflow:hidden;
}

.kpi::after{
  content:'';position:absolute;top:0;left:0;right:0;
  height:1px;
  background:linear-gradient(90deg,transparent,var(--neon),transparent);
  opacity:0;transition:opacity 0.3s;
}
.kpi:hover{
  border-color:var(--border-hover);
  transform:translateY(-1px);
}
.kpi:hover::after{opacity:0.4;}

.kpi-label{
  font-family:'IBM Plex Mono',monospace;
  font-size:9.5px;text-transform:uppercase;
  letter-spacing:1.8px;
  color:var(--text-dim);
  margin-bottom:10px;
}

.kpi-val{
  font-family:'IBM Plex Mono',monospace;
  font-size:26px;font-weight:700;
  letter-spacing:-0.5px;line-height:1;
}
.kpi-val.green{color:var(--neon);}
.kpi-val.white{color:var(--text);}

.kpi-foot{
  margin-top:8px;font-size:11px;color:var(--text-dim);
  display:flex;align-items:center;gap:6px;
}

.tag{
  display:inline-flex;align-items:center;gap:3px;
  padding:2px 8px;border-radius:5px;
  font-family:'IBM Plex Mono',monospace;
  font-size:9px;font-weight:700;letter-spacing:0.3px;
}
.tag.up{background:rgba(50,230,133,0.1);color:var(--neon);border:1px solid rgba(50,230,133,0.15);}
.tag.down{background:var(--red-glow);color:var(--red);border:1px solid rgba(255,68,102,0.15);}

/* ═══ CARD ═══ */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:22px;
  backdrop-filter:blur(20px);
}

.card-h{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:18px;
}
.card-t{font-size:14px;font-weight:600;color:var(--text2);}
.card-t small{font-weight:400;color:var(--text-dim);font-size:11px;margin-left:6px;}

/* ═══ LAYOUTS ═══ */
.row-2-1{display:grid;grid-template-columns:2.3fr 1fr;gap:12px;margin-bottom:22px;}
.row-1-1{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:22px;}
.full{margin-bottom:22px;}

/* ═══ SITE CARDS ═══ */
.site-head{display:flex;align-items:center;gap:10px;margin-bottom:16px;}
.site-dot{width:8px;height:8px;border-radius:50%;}
.site-name{font-weight:700;font-size:16px;}

.site-nums{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;}
.sn-label{
  font-family:'IBM Plex Mono',monospace;
  font-size:9px;text-transform:uppercase;
  letter-spacing:0.5px;color:var(--text-dim);
  margin-bottom:2px;
}
.sn-val{
  font-family:'IBM Plex Mono',monospace;
  font-size:18px;font-weight:700;color:var(--text);
}

.sparkline-wrap{height:140px;}

/* ═══ TABLE ═══ */
.tbl-wrap{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--r);padding:22px;
  margin-bottom:22px;backdrop-filter:blur(20px);
}
.tbl-scroll{max-height:380px;overflow-y:auto;}
.tbl-scroll::-webkit-scrollbar{width:3px;}
.tbl-scroll::-webkit-scrollbar-track{background:transparent;}
.tbl-scroll::-webkit-scrollbar-thumb{background:var(--text-muted);border-radius:3px;}

table{width:100%;border-collapse:collapse;}
th{
  font-family:'IBM Plex Mono',monospace;
  font-size:9px;text-transform:uppercase;letter-spacing:1.2px;
  color:var(--text-dim);text-align:left;
  padding:8px 10px;border-bottom:1px solid var(--border);
  font-weight:400;position:sticky;top:0;
  background:var(--surface-solid);z-index:2;
}
td{
  padding:7px 10px;border-bottom:1px solid rgba(34,80,55,0.15);
  font-family:'IBM Plex Mono',monospace;font-size:11px;
  color:var(--text2);
}
tr:hover td{background:rgba(50,230,133,0.015);}

.g{color:var(--neon);font-weight:600;}
.r{color:var(--red);font-weight:600;}
.dot{display:inline-block;width:6px;height:6px;border-radius:50%;}
.dot.ok{background:var(--neon);box-shadow:0 0 6px rgba(50,230,133,0.5);}
.dot.no{background:var(--red);box-shadow:0 0 6px rgba(255,68,102,0.5);}

/* ═══ PROJECTIONS ═══ */
.proj{
  background:linear-gradient(135deg,rgba(50,230,133,0.04),rgba(0,201,167,0.02));
  border:1px solid rgba(50,230,133,0.12);
  border-radius:var(--r);padding:28px;
  margin-bottom:22px;position:relative;overflow:hidden;
}
.proj::before{
  content:'';position:absolute;
  top:-60%;right:-15%;width:450px;height:450px;
  background:radial-gradient(circle,rgba(50,230,133,0.05),transparent 65%);
  pointer-events:none;
}
.proj-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;margin-top:20px;position:relative;}
.proj-v{
  font-family:'IBM Plex Mono',monospace;
  font-size:24px;font-weight:700;color:var(--neon);
  text-align:center;
}
.proj-l{
  font-size:10px;color:var(--text-dim);text-transform:uppercase;
  letter-spacing:0.5px;margin-top:4px;text-align:center;
}

/* ═══ ANIMATIONS ═══ */
@keyframes up{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
.an{animation:up 0.6s cubic-bezier(0.16,1,0.3,1) forwards;opacity:0;}
.a1{animation-delay:.03s;}.a2{animation-delay:.06s;}.a3{animation-delay:.09s;}
.a4{animation-delay:.12s;}.a5{animation-delay:.15s;}.a6{animation-delay:.18s;}
.a7{animation-delay:.21s;}.a8{animation-delay:.24s;}

/* ═══ RESPONSIVE ═══ */
@media(max-width:1200px){
  .kpi-strip{grid-template-columns:repeat(3,1fr);}
  .row-2-1,.row-1-1{grid-template-columns:1fr;}
  .main{padding:20px 20px;}
  .header{padding:14px 20px;}
}

@media(max-width:768px){
  .header{flex-direction:column;gap:12px;align-items:flex-start;padding:14px 16px;}
  .header-info{width:100%;justify-content:flex-end;}
  .main{padding:16px 14px;}
  
  .topbar{flex-direction:column;align-items:flex-start;gap:12px;}
  .page-title{font-size:26px;}
  
  .kpi-strip{grid-template-columns:repeat(2,1fr);gap:8px;}
  .kpi{padding:16px;}
  .kpi-val{font-size:22px;}
  .kpi-label{font-size:8.5px;letter-spacing:1.2px;}
  
  .row-2-1,.row-1-1{grid-template-columns:1fr;gap:10px;}
  .card{padding:16px;}
  
  .site-nums{grid-template-columns:repeat(3,1fr);gap:6px;}
  .sn-val{font-size:15px;}
  
  .proj-grid{grid-template-columns:1fr 1fr;gap:16px;}
  .proj-v{font-size:20px;}
  
  table{font-size:10px;}
  td,th{padding:6px 8px;}
  
  .site-tabs{flex-wrap:wrap;}
  .site-tab{padding:7px 16px;font-size:11px;}
  
  .brand-name{font-size:19px;}
}

@media(max-width:420px){
  .kpi-strip{grid-template-columns:1fr 1fr;gap:6px;}
  .kpi:nth-child(5){grid-column:span 2;}
  .kpi-val{font-size:20px;}
  .page-title{font-size:22px;}
  .brand-name{font-size:17px;}
  .header-date{font-size:10px;padding:5px 10px;}
}
</style>
</head>
<body>

<!-- Background -->
<div class="bg-scene">
  <div class="glow glow-1"></div>
  <div class="glow glow-2"></div>
  <div class="glow glow-3"></div>
</div>
<div class="grid-overlay"></div>
<div class="grain"></div>

<div class="app">

<!-- ═══ HEADER ═══ -->
<header class="header">
  <div class="brand">
    <svg class="tree-logo" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Majestic oak tree -->
      <!-- Trunk with roots -->
      <path d="M54 78 L52 105 Q50 112 44 115 L42 116" stroke="#2d6b47" stroke-width="2.5" stroke-linecap="round" fill="none"/>
      <path d="M66 78 L68 105 Q70 112 76 115 L78 116" stroke="#2d6b47" stroke-width="2.5" stroke-linecap="round" fill="none"/>
      <path d="M56 82 L55 105 Q54 110 50 112" stroke="#2d6b47" stroke-width="1.5" stroke-linecap="round" fill="none" opacity="0.6"/>
      <path d="M64 82 L65 105 Q66 110 70 112" stroke="#2d6b47" stroke-width="1.5" stroke-linecap="round" fill="none" opacity="0.6"/>
      <rect x="55" y="68" width="10" height="16" rx="2" fill="#1a4a30"/>
      <rect x="57" y="70" width="2.5" height="12" rx="1" fill="#32e685" opacity="0.08"/>
      
      <!-- Main canopy - layered for depth -->
      <!-- Outer shadow -->
      <ellipse cx="60" cy="48" rx="38" ry="30" fill="#081a10" opacity="0.5"/>
      <!-- Base layer -->
      <ellipse cx="60" cy="46" rx="36" ry="28" fill="#0d2518"/>
      <!-- Mid layer -->
      <ellipse cx="58" cy="44" rx="30" ry="24" fill="#112e1e"/>
      <ellipse cx="63" cy="43" rx="28" ry="22" fill="#143823"/>
      <!-- Top clusters - organic shapes -->
      <ellipse cx="45" cy="42" rx="16" ry="14" fill="#184228"/>
      <ellipse cx="75" cy="42" rx="15" ry="13" fill="#174028"/>
      <ellipse cx="60" cy="34" rx="20" ry="16" fill="#1a4a2d"/>
      <ellipse cx="50" cy="36" rx="14" ry="12" fill="#1c5032"/>
      <ellipse cx="72" cy="37" rx="13" ry="11" fill="#1b4c30"/>
      <!-- Crown highlight -->
      <ellipse cx="58" cy="32" rx="16" ry="10" fill="#1e5435"/>
      <ellipse cx="60" cy="30" rx="10" ry="7" fill="#205838"/>
      
      <!-- Neon edge glow -->
      <ellipse cx="60" cy="36" rx="32" ry="24" fill="none" stroke="url(#edgeGlow)" stroke-width="0.7"/>
      <ellipse cx="60" cy="32" rx="22" ry="14" fill="none" stroke="#32e685" stroke-width="0.4" opacity="0.2"/>
      
      <!-- Inner light -->
      <ellipse cx="60" cy="40" rx="18" ry="12" fill="url(#innerLight)" opacity="0.5"/>
      
      <!-- Subtle leaf texture dots -->
      <circle cx="42" cy="38" r="1" fill="#32e685" opacity="0.12"/>
      <circle cx="52" cy="30" r="0.8" fill="#32e685" opacity="0.1"/>
      <circle cx="68" cy="32" r="1" fill="#32e685" opacity="0.08"/>
      <circle cx="76" cy="40" r="0.7" fill="#32e685" opacity="0.1"/>
      <circle cx="55" cy="44" r="0.6" fill="#32e685" opacity="0.15"/>
      <circle cx="65" cy="28" r="0.9" fill="#32e685" opacity="0.1"/>
      
      <defs>
        <radialGradient id="innerLight" cx="0.5" cy="0.3" r="0.7">
          <stop offset="0%" stop-color="#32e685" stop-opacity="0.15"/>
          <stop offset="100%" stop-color="#32e685" stop-opacity="0"/>
        </radialGradient>
        <linearGradient id="edgeGlow" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#32e685" stop-opacity="0.15"/>
          <stop offset="30%" stop-color="#32e685" stop-opacity="0.06"/>
          <stop offset="70%" stop-color="#32e685" stop-opacity="0.12"/>
          <stop offset="100%" stop-color="#32e685" stop-opacity="0.04"/>
        </linearGradient>
      </defs>
    </svg>
    <div class="brand-text">
      <div class="brand-name">FORÊT <em>WASH</em></div>
      <div class="brand-sub">Forêt Capital</div>
    </div>
  </div>
  <div class="header-info">
    <span class="header-date">Février 2026</span>
  </div>
</header>

<div class="main">

  <!-- Topbar -->
  <div class="topbar an a1">
    <h1 class="page-title">Tableau de <span>bord</span></h1>
    <div class="site-tabs" id="siteTabs">
      <button class="site-tab active" data-site="all">Global</button>
      <button class="site-tab" data-site="lp">Les Pieux</button>
      <button class="site-tab" data-site="mv">Martinvast</button>
    </div>
  </div>

  <!-- KPIs -->
  <div class="kpi-strip" id="kpiStrip">
    <div class="kpi an a1">
      <div class="kpi-label">CA Total HT</div>
      <div class="kpi-val green" id="kpi-ca">12 978 €</div>
      <div class="kpi-foot"><span class="tag up">● Rentable</span><span id="kpi-ca-sub">25 jours</span></div>
    </div>
    <div class="kpi an a2">
      <div class="kpi-label">CA TTC Mensuel</div>
      <div class="kpi-val white" id="kpi-ttc">15 573 €</div>
      <div class="kpi-foot" id="kpi-ttc-sub">CB uniquement</div>
    </div>
    <div class="kpi an a3">
      <div class="kpi-label">Moyenne / Jour</div>
      <div class="kpi-val white" id="kpi-avg">519 €</div>
      <div class="kpi-foot">CA HT quotidien</div>
    </div>
    <div class="kpi an a4">
      <div class="kpi-label">Power Jets</div>
      <div class="kpi-val white" id="kpi-pj">9 338</div>
      <div class="kpi-foot" id="kpi-pj-sub">LP: 5 678 · MV: 3 660</div>
    </div>
    <div class="kpi an a5">
      <div class="kpi-label">Pistes HP</div>
      <div class="kpi-val white" id="kpi-hp">8 378</div>
      <div class="kpi-foot" id="kpi-hp-sub">LP: 2 160 · MV: 6 218</div>
    </div>
  </div>

  <!-- Daily CA + Donut -->
  <div class="row-2-1">
    <div class="card an a3">
      <div class="card-h">
        <div class="card-t">CA Journalier HT <small>Février 2026</small></div>
      </div>
      <div style="height:260px;"><canvas id="chartDaily"></canvas></div>
    </div>
    <div class="card an a4">
      <div class="card-h">
        <div class="card-t">Répartition</div>
      </div>
      <div style="height:260px;"><canvas id="chartDonut"></canvas></div>
    </div>
  </div>

  <!-- Site cards -->
  <div class="row-1-1" id="siteCards">
    <div class="card an a4" id="card-lp">
      <div class="site-head">
        <div class="site-dot" style="background:var(--neon);box-shadow:0 0 8px rgba(50,230,133,0.5);"></div>
        <div class="site-name">Les Pieux</div>
      </div>
      <div class="site-nums">
        <div><div class="sn-label">Power Jet</div><div class="sn-val">5 678</div></div>
        <div><div class="sn-label">Pistes HP</div><div class="sn-val">2 160</div></div>
        <div><div class="sn-label">Total</div><div class="sn-val">8 838</div></div>
      </div>
      <div class="sparkline-wrap"><canvas id="sparkLP"></canvas></div>
    </div>
    <div class="card an a5" id="card-mv">
      <div class="site-head">
        <div class="site-dot" style="background:var(--teal);box-shadow:0 0 8px rgba(0,201,167,0.5);"></div>
        <div class="site-name">Martinvast</div>
      </div>
      <div class="site-nums">
        <div><div class="sn-label">Power Jet</div><div class="sn-val">5 345</div></div>
        <div><div class="sn-label">Pistes HP</div><div class="sn-val">2 390</div></div>
        <div><div class="sn-label">Total</div><div class="sn-val">7 735</div></div>
      </div>
      <div class="sparkline-wrap"><canvas id="sparkMV"></canvas></div>
    </div>
  </div>

  <!-- Table -->
  <div class="tbl-wrap an a5">
    <div class="card-h">
      <div class="card-t">Détail Journalier <small>Février 2026</small></div>
    </div>
    <div class="tbl-scroll">
      <table>
        <thead>
          <tr>
            <th>Date</th><th>CA CB</th><th>CA TTC</th><th>CA HT</th>
            <th>Les Pieux</th><th>Martinvast</th><th></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- YoY -->
  <div class="card full an a6">
    <div class="card-h">
      <div class="card-t">Évolution CA HT <small>Comparaison annuelle</small></div>
    </div>
    <div style="height:300px;"><canvas id="chartYoY"></canvas></div>
  </div>

  <!-- Projections -->
  <div class="proj an a7">
    <div class="card-t" style="font-size:16px;">Projections</div>
    <div class="proj-grid">
      <div><div class="proj-v">15 789 €</div><div class="proj-l">CA HT prév. mensuel</div></div>
      <div><div class="proj-v">189 472 €</div><div class="proj-l">CA HT prév. annuel</div></div>
      <div><div class="proj-v">183 064 €</div><div class="proj-l">CA HT 2025/2026</div></div>
      <div><div class="proj-v" style="color:var(--neon);">+5%</div><div class="proj-l">vs ancien proprio</div></div>
    </div>
  </div>

</div>
</div>

<script>
// ═══ THEME ═══
const N='#32e685',N2='#28d47a',T='#00c9a7',R='#ff4466';
Chart.defaults.color='#4a7a5e';
Chart.defaults.borderColor='rgba(34,80,55,0.25)';
Chart.defaults.font.family="'IBM Plex Mono',monospace";
Chart.defaults.font.size=10;

const ttStyle={backgroundColor:'rgba(8,15,10,0.95)',borderColor:'rgba(50,230,133,0.2)',borderWidth:1,titleColor:'#eaf5ef',bodyColor:'#7bb898',padding:10,cornerRadius:8,displayColors:false};

// ═══ DATA ═══
const D=Array.from({length:25},(_,i)=>i+1);
const caCB=[709,497,503,902,318,656,1127,850,372,186,270,668,776,1168,246,550,738,160,366,708,426,198,482,1127,1570];
const caHT=[590.83,414.17,419.17,751.67,265.00,546.67,939.17,708.33,310.00,155.00,225.00,556.67,646.67,973.33,205.00,458.33,615.00,133.33,305.00,590.00,355.00,165.00,401.67,939.17,1308.33];
const lpT=[310,274,277,466,148,382,617,439,188,138,148,371,318,534,134,228,422,42,204,364,200,126,230,548,730];
const mvT=[399,223,226,436,170,274,510,411,184,48,122,297,458,634,112,322,316,118,162,344,226,72,252,579,840];

// LP individual data
const lpPJc=[96,90,74,160,58,106,170,158,56,30,24,144,150,106,54,86,174,12,86,134,78,14,110,200,220];
const lpPJsc=[154,84,88,236,50,186,242,146,92,88,84,132,138,268,60,82,128,0,48,150,82,62,80,178,230];
const lpHPc=[0,80,40,0,0,60,90,25,0,0,20,0,20,20,20,40,60,30,0,25,10,10,10,80,170];
const lpHPsc=[60,20,75,70,40,30,115,110,40,20,20,95,10,140,0,20,60,0,70,55,30,40,30,90,110];

// MV individual data
const mvPJc=[68,36,28,68,16,0,36,32,8,0,46,37,86,66,26,28,12,0,28,48,82,0,10,82,8];
const mvPJsc=[206,132,158,208,64,244,324,254,156,28,36,200,232,328,46,204,184,88,64,206,104,62,192,322,452];
const mvHPc=[10,45,30,120,50,0,30,0,10,10,20,20,55,60,0,10,30,10,0,30,0,0,0,10,120];
const mvHPsc=[115,10,10,40,40,30,120,125,10,10,20,40,85,180,40,80,90,20,70,60,40,10,50,165,260];

const BE=400;

// ═══ CHARTS ═══
let chartDaily, chartDonut, chartLP, chartMV;

function createDailyChart(data, labels){
  if(chartDaily) chartDaily.destroy();
  chartDaily=new Chart(document.getElementById('chartDaily'),{
    type:'bar',
    data:{
      labels,
      datasets:[{
        label:'CA HT',data,
        backgroundColor:data.map(v=>v>=BE?'rgba(50,230,133,0.5)':'rgba(255,68,102,0.35)'),
        hoverBackgroundColor:data.map(v=>v>=BE?'rgba(50,230,133,0.75)':'rgba(255,68,102,0.6)'),
        borderRadius:4,borderSkipped:false,
      },{
        label:'Seuil',data:new Array(data.length).fill(BE),type:'line',
        borderColor:'rgba(200,164,78,0.4)',borderDash:[5,4],borderWidth:1.5,
        pointRadius:0,fill:false,
      }]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{...ttStyle,callbacks:{label:c=>c.datasetIndex===1?'Seuil: '+BE+'€':'CA HT: '+c.parsed.y.toFixed(2)+'€'}}},
      scales:{
        y:{beginAtZero:true,grid:{color:'rgba(34,80,55,0.15)'},ticks:{callback:v=>v+'€'}},
        x:{grid:{display:false}}
      }
    }
  });
}

function createDonutChart(data, labels, colors){
  if(chartDonut) chartDonut.destroy();
  chartDonut=new Chart(document.getElementById('chartDonut'),{
    type:'doughnut',
    data:{
      labels,
      datasets:[{data,backgroundColor:colors,hoverBackgroundColor:colors.map(c=>c.replace('0.7','0.95')),borderWidth:0,spacing:4,borderRadius:6}]
    },
    options:{
      responsive:true,maintainAspectRatio:false,cutout:'74%',
      plugins:{legend:{position:'bottom',labels:{padding:14,usePointStyle:true,pointStyleWidth:8,color:'#5a8a70',font:{size:10}}}}
    }
  });
}

function createSparkline(id, data, color, existingChart){
  if(existingChart) existingChart.destroy();
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{
      labels:D,
      datasets:[{data,borderColor:color,backgroundColor:color+'12',fill:true,tension:0.4,borderWidth:2,pointRadius:0,pointHitRadius:10}]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:ttStyle},
      scales:{
        y:{beginAtZero:true,grid:{color:'rgba(34,80,55,0.12)'},ticks:{display:false}},
        x:{grid:{display:false},ticks:{maxTicksLimit:6}}
      }
    }
  });
}

function buildTable(site){
  const tbody=document.getElementById('tbody');
  tbody.innerHTML='';
  D.forEach((d,i)=>{
    let cb,ht,lp,mv;
    if(site==='all'){cb=caCB[i];ht=caHT[i];lp=lpT[i];mv=mvT[i];}
    else if(site==='lp'){
      lp=lpT[i]; mv='—';
      // Approx: LP contributes ~50-55% of daily CA proportionally
      const ratio=lpT[i]/(lpT[i]+mvT[i]||1);
      cb=Math.round(caCB[i]*ratio);ht=+(caHT[i]*ratio).toFixed(2);
    } else {
      lp='—'; mv=mvT[i];
      const ratio=mvT[i]/(lpT[i]+mvT[i]||1);
      cb=Math.round(caCB[i]*ratio);ht=+(caHT[i]*ratio).toFixed(2);
    }
    const ok=ht>=BE*(site==='all'?1:0.5);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d}/02</td><td>${cb.toLocaleString('fr-FR')}€</td><td>${cb.toLocaleString('fr-FR')}€</td><td class="${ok?'g':'r'}">${typeof ht==='number'?ht.toFixed(2):ht}€</td><td>${typeof lp==='number'?lp.toLocaleString('fr-FR'):lp}</td><td>${typeof mv==='number'?mv.toLocaleString('fr-FR'):mv}</td><td><span class="dot ${ok?'ok':'no'}"></span></td>`;
    tbody.appendChild(tr);
  });
}

// ═══ SITE FILTERING ═══
let currentSite='all';

function updateDashboard(site){
  currentSite=site;
  const siteCards=document.getElementById('siteCards');
  const cardLP=document.getElementById('card-lp');
  const cardMV=document.getElementById('card-mv');

  if(site==='all'){
    // KPIs
    document.getElementById('kpi-ca').textContent='12 978 €';
    document.getElementById('kpi-ttc').textContent='15 573 €';
    document.getElementById('kpi-avg').textContent='519 €';
    document.getElementById('kpi-pj').textContent='9 338';
    document.getElementById('kpi-hp').textContent='8 378';
    document.getElementById('kpi-pj-sub').textContent='LP: 5 678 · MV: 3 660';
    document.getElementById('kpi-hp-sub').textContent='LP: 2 160 · MV: 6 218';
    
    createDailyChart(caHT, D);
    createDonutChart([8838,7735],['Les Pieux','Martinvast'],['rgba(50,230,133,0.7)','rgba(0,201,167,0.7)']);
    
    cardLP.style.display='';cardMV.style.display='';
    siteCards.style.gridTemplateColumns='1fr 1fr';
    chartLP=createSparkline('sparkLP',lpT,N,chartLP);
    chartMV=createSparkline('sparkMV',mvT,T,chartMV);
    
  } else if(site==='lp'){
    const lpPJ=lpPJc.reduce((a,b)=>a+b,0)+lpPJsc.reduce((a,b)=>a+b,0);
    const lpHP=lpHPc.reduce((a,b)=>a+b,0)+lpHPsc.reduce((a,b)=>a+b,0);
    const lpTot=lpPJ+lpHP;
    // Approximate CA for LP only
    const lpRatios=D.map((_,i)=>lpT[i]/(lpT[i]+mvT[i]||1));
    const lpHTvals=D.map((_,i)=>+(caHT[i]*lpRatios[i]).toFixed(2));
    const totalHTlp=lpHTvals.reduce((a,b)=>a+b,0);
    const totalTTClp=D.reduce((s,_,i)=>s+Math.round(caCB[i]*lpRatios[i]),0);
    
    document.getElementById('kpi-ca').textContent=Math.round(totalHTlp).toLocaleString('fr-FR')+' €';
    document.getElementById('kpi-ttc').textContent=totalTTClp.toLocaleString('fr-FR')+' €';
    document.getElementById('kpi-avg').textContent=Math.round(totalHTlp/25)+' €';
    document.getElementById('kpi-pj').textContent=lpPJ.toLocaleString('fr-FR');
    document.getElementById('kpi-hp').textContent=lpHP.toLocaleString('fr-FR');
    document.getElementById('kpi-pj-sub').textContent='contact + sans contact';
    document.getElementById('kpi-hp-sub').textContent='contact + sans contact';
    
    createDailyChart(lpHTvals, D);
    createDonutChart([lpPJ,lpHP],['Power Jet','Pistes HP'],['rgba(50,230,133,0.7)','rgba(50,230,133,0.35)']);
    
    cardLP.style.display='';cardMV.style.display='none';
    siteCards.style.gridTemplateColumns='1fr';
    chartLP=createSparkline('sparkLP',lpT,N,chartLP);
    
  } else {
    const mvPJ=mvPJc.reduce((a,b)=>a+b,0)+mvPJsc.reduce((a,b)=>a+b,0);
    const mvHP=mvHPc.reduce((a,b)=>a+b,0)+mvHPsc.reduce((a,b)=>a+b,0);
    const mvRatios=D.map((_,i)=>mvT[i]/(lpT[i]+mvT[i]||1));
    const mvHTvals=D.map((_,i)=>+(caHT[i]*mvRatios[i]).toFixed(2));
    const totalHTmv=mvHTvals.reduce((a,b)=>a+b,0);
    const totalTTCmv=D.reduce((s,_,i)=>s+Math.round(caCB[i]*mvRatios[i]),0);
    
    document.getElementById('kpi-ca').textContent=Math.round(totalHTmv).toLocaleString('fr-FR')+' €';
    document.getElementById('kpi-ttc').textContent=totalTTCmv.toLocaleString('fr-FR')+' €';
    document.getElementById('kpi-avg').textContent=Math.round(totalHTmv/25)+' €';
    document.getElementById('kpi-pj').textContent=mvPJ.toLocaleString('fr-FR');
    document.getElementById('kpi-hp').textContent=mvHP.toLocaleString('fr-FR');
    document.getElementById('kpi-pj-sub').textContent='contact + sans contact';
    document.getElementById('kpi-hp-sub').textContent='contact + sans contact';
    
    createDailyChart(mvHTvals, D);
    createDonutChart([mvPJ,mvHP],['Power Jet','Pistes HP'],['rgba(0,201,167,0.7)','rgba(0,201,167,0.35)']);
    
    cardLP.style.display='none';cardMV.style.display='';
    siteCards.style.gridTemplateColumns='1fr';
    chartMV=createSparkline('sparkMV',mvT,T,chartMV);
  }
  
  buildTable(site);
}

// Tab click handlers
document.querySelectorAll('.site-tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.site-tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    updateDashboard(tab.dataset.site);
  });
});

// ═══ YOY CHART ═══
const months=['Avr','Mai','Juin','Juil','Août','Sep','Oct','Nov','Déc','Jan','Fév','Mar'];
const yoy={
  '2019/20':[3805,5390,5185,7805,6375,4597,4962,4115,7270,7636,5762,3478],
  '2020/21':[1175,8635,5369,7849,7782,6287,5549,4980,6085,6802,9489,9621],
  '2021/22':[8763,7984,8127,9846,9912,8924,7710,7253,8078,10303,9259,12275],
  '2022/23':[10814,12750,9736,13519,9773,4024,6888,5721,7223,9641,11300,11907],
  '2023/24':[16703,24374,25285,12691,14289,17290,14500,11117,18277,19249,15151,20182],
  '2024/25':[20477,21244,20061,16852,17097,10855,20200,18883,15295,16802,18373,21500],
  '2025/26':[22600,20700,18724,17585,26796,11162,14103,13155,20403,17836,null,null],
};
const yC=['#334155','#64748b','#78716c','#c8a44e','#22c55e','#3b82f6',N];

new Chart(document.getElementById('chartYoY'),{
  type:'line',
  data:{
    labels:months,
    datasets:Object.keys(yoy).map((k,i)=>({
      label:k,data:yoy[k],
      borderColor:yC[i],
      borderWidth:k==='2025/26'?2.5:1,
      pointRadius:k==='2025/26'?3.5:0,
      pointBackgroundColor:yC[i],
      pointBorderColor:k==='2025/26'?'#050907':'transparent',
      pointBorderWidth:k==='2025/26'?2:0,
      tension:0.35,
      borderDash:k==='2025/26'?[]:[3,3],
      spanGaps:false,
    }))
  },
  options:{
    responsive:true,maintainAspectRatio:false,
    plugins:{
      legend:{position:'bottom',labels:{padding:14,usePointStyle:true,pointStyleWidth:8,color:'#4a7a5e',font:{size:9}}},
      tooltip:{...ttStyle,callbacks:{label:c=>c.dataset.label+': '+(c.parsed.y!=null?c.parsed.y.toLocaleString('fr-FR')+' €':'—')}}
    },
    scales:{
      y:{grid:{color:'rgba(34,80,55,0.15)'},ticks:{callback:v=>(v/1000).toFixed(0)+'k'}},
      x:{grid:{display:false}}
    }
  }
});

// ═══ INIT ═══
updateDashboard('all');
</script>
</body>
</html>
